{"version":3,"file":"boundle.umd.js","sources":["../src/vnode/vnode.ts","../src/vnode/fragment.ts","../src/vnode/text.ts","../src/vnode/array.ts","../src/utils.ts","../src/reactive/update.ts","../src/reactive/reactive.ts","../src/reactive/ref.ts","../src/reactive/utils.ts","../src/reactive/active.ts","../src/vnode/alive.ts","../src/render.ts","../src/reactive/watch.ts","../src/mount/element.ts","../src/mount/patch.ts","../src/mount/mount.ts","../src/component.ts","../src/vact.ts"],"sourcesContent":["import { Activer } from \"../reactive\"\r\nimport { ComponentConstructor } from './component'\r\n\r\n/**\r\n * 虚拟dom节点类型枚举\r\n*/\r\nexport enum VNODE_TYPE {\r\n  // 普通元素节点类型\r\n  ELEMENT,\r\n  // 文本节点类型\r\n  TEXT,\r\n  FRAGMENT,\r\n  COMPONENT,\r\n  ARRAYNODE,\r\n  ALIVE\r\n}\r\n\r\n/**\r\n * 虚拟dom接口类型\r\n*/\r\nexport interface VNode {\r\n\r\n  // 虚拟节点类型\r\n  type: string | symbol | ComponentConstructor,\r\n\r\n  // 虚拟节点表标识\r\n  flag: VNODE_TYPE\r\n\r\n  // 虚拟节点属性\r\n  props?: Record<string, any>,\r\n\r\n  // 虚拟节点子节点\r\n  children?: Array<VNode> | string,\r\n\r\n  // 真实节点\r\n  el?: HTMLElement | Text\r\n  anchor?: Text\r\n\r\n  activer?: Activer\r\n  // 目前存在的节点\r\n  vnode?: VNode\r\n\r\n}\r\n\r\n","import { VNode, VNODE_TYPE } from \"./vnode\";\r\n\r\nexport const FragmentSymbol = Symbol('Fragment');\r\nexport interface VFragment extends VNode {\r\n\r\n  // 虚拟节点类型\r\n  type: symbol,\r\n\r\n  // 虚拟节点子节点\r\n  children: Array<VNode>,\r\n\r\n  // 虚拟节点表标识\r\n  flag: VNODE_TYPE.FRAGMENT\r\n\r\n  // 锚点\r\n  anchor: Text,\r\n  el: Text\r\n\r\n}","import { VNode, VNODE_TYPE } from \"./vnode\";\r\n\r\n\r\nexport const TextSymbol = Symbol('Text');\r\nexport interface VText extends VNode {\r\n\r\n  // 虚拟节点类型\r\n  type: symbol,\r\n\r\n  // 虚拟节点子节点\r\n  children: string,\r\n\r\n  // 虚拟节点表标识\r\n  flag: VNODE_TYPE.TEXT\r\n\r\n  el: Text\r\n\r\n}","import { VNode, VNODE_TYPE } from \"./vnode\";\r\n\r\nexport const ArraySymbol = Symbol('ArrayNode');\r\nexport interface VArrayNode extends VNode {\r\n\r\n  // 虚拟节点类型\r\n  type: symbol,\r\n\r\n  // 虚拟节点子节点\r\n  children: Array<VNode>,\r\n\r\n  // 虚拟节点表标识\r\n  flag: VNODE_TYPE.ARRAYNODE\r\n\r\n  // 锚点\r\n  anchor: Text,\r\n  el: Text,\r\n\r\n  // 记录当前数组节点依赖的响应式数组\r\n  depArray: Array<any>\r\n}","import { VNode, VNODE_TYPE } from './vnode/vnode'\r\nimport { Activer } from './reactive/active'\r\nimport { FragmentSymbol } from './vnode/fragment'\r\nimport { TextSymbol } from './vnode/text'\r\nimport { ArraySymbol } from './vnode/array'\r\n\r\nexport function isString(content: unknown): content is string {\r\n  return typeof content === 'string'\r\n}\r\n\r\nexport function isFunction(content: unknown): content is Function {\r\n  return typeof content === 'function'\r\n}\r\n\r\nexport function isFragment(content: unknown): boolean {\r\n  return content === FragmentSymbol\r\n}\r\n\r\nexport function isArrayNode(content: unknown): boolean {\r\n  return content === ArraySymbol\r\n}\r\n\r\nexport function isText(content: unknown): boolean {\r\n  return content === TextSymbol\r\n}\r\n\r\nexport function isActiver(content: unknown): content is Activer {\r\n  return isObject(content) && (content as Record<any, any>).flag === 'activer'\r\n}\r\n\r\nexport function isVNode(content: unknown): content is VNode {\r\n  return isObject(content) && (content as Record<any, any>).flag in VNODE_TYPE\r\n}\r\n\r\nexport function isObjectExact(content: unknown): content is Object {\r\n  return isObject(content) && content.constructor === Object\r\n}\r\n\r\nexport function isOnEvent(str: string): boolean {\r\n  return /^on.+$/.test(str)\r\n}\r\n\r\nexport function isObject(content: unknown): content is object {\r\n  return typeof content === 'object' && content !== null\r\n}\r\n\r\n\r\nexport function isArray(content: unknown): content is Array<any> {\r\n  return Array.isArray(content)\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { Watcher } from \"./watch\";\r\n\r\nlet updating = false\r\nconst watcherTask: Array<Watcher> = []\r\n\r\nexport function runUpdate(watcher: Watcher) {\r\n  let index: number = watcherTask.indexOf(watcher)\r\n  if (!(index > -1)) watcherTask.push(watcher)\r\n  if (!updating) {\r\n    updating = true\r\n    Promise.resolve()\r\n      .then(() => {\r\n        let watcher: Watcher | undefined = undefined\r\n        while (watcher = watcherTask.shift()) {\r\n          watcher.update()\r\n        }\r\n      }).finally(() => {\r\n        updating = false\r\n      })\r\n  }\r\n}","import { isArray, isObjectExact, isVNode } from \"../utils\"\r\nimport { Watcher } from \"./watch\"\r\nimport { runUpdate } from './update'\r\n\r\n// 目标对象到映射对象\r\nconst targetMap = new WeakMap()\r\n// 全局变量watcher\r\nlet activeWatcher: Watcher | null = null\r\nconst REACTIVE = Symbol('reactive')\r\n\r\n/**\r\n * 实现响应式对象\r\n*/\r\nexport function reactive<T extends Record<string | symbol, any>>(target: T): T {\r\n  if (target[REACTIVE]) return target\r\n\r\n  let handler: ProxyHandler<T> = {\r\n    get(target, prop, receiver) {\r\n      if (prop === REACTIVE) return true\r\n      const res = Reflect.get(target, prop, receiver)\r\n\r\n      if (isObjectExact(res) && !isVNode(res)) {\r\n        return reactive(res)\r\n      }\r\n\r\n      if (Array.isArray(res)) {\r\n        track(target, prop)\r\n        return reactiveArray(res, target, prop)\r\n      }\r\n\r\n      track(target, prop)\r\n      return res\r\n    },\r\n\r\n    set(target, prop, value, receiver) {\r\n      const res = Reflect.set(target, prop, value, receiver)\r\n      trigger(target, prop)\r\n      return res\r\n    }\r\n  }\r\n\r\n  return new Proxy(target, handler)\r\n}\r\n\r\n/**\r\n * 设置响应式数组\r\n*/\r\nfunction reactiveArray(targetArr: Array<any>, targetObj: Record<any, any>, Arrprop: string | symbol) {\r\n  let handler: ProxyHandler<Record<any, any>> = {\r\n    get(target, prop, receiver) {\r\n      const res = Reflect.get(target, prop, receiver)\r\n\r\n      if (isObjectExact(res)) {\r\n        return reactive(res)\r\n      }\r\n\r\n      return res\r\n    },\r\n    set(target, prop, value, receiver) {\r\n      const res = Reflect.set(target, prop, value, receiver)\r\n      trigger(targetObj, Arrprop)\r\n      return res\r\n    }\r\n  }\r\n\r\n  return new Proxy(targetArr, handler)\r\n}\r\n\r\n/**\r\n * 响应触发依赖\r\n*/\r\nexport function trigger(target: Record<string | symbol, any>, prop: string | symbol) {\r\n  let mapping: Record<string | symbol, Array<Watcher>> = targetMap.get(target)\r\n  if (!mapping) return\r\n\r\n  let mappingProp: Array<Watcher> = mapping[prop]\r\n  if (!mappingProp) return\r\n\r\n  // mappingProp.forEach(watcher => watcher.update(oldValue, newValue))\r\n  mappingProp.forEach(watcher => {\r\n    // 针对于对数组响应做特殊处理\r\n    if (isArray(target[prop])) {\r\n      watcher.nextDepArr = target[prop]\r\n    }\r\n    runUpdate(watcher)\r\n  })\r\n}\r\n\r\n/**\r\n * 追踪绑定依赖\r\n*/\r\nexport function track(target: Record<string | symbol, any>, prop: string | symbol) {\r\n  if (!activeWatcher) return\r\n\r\n  let mapping: Record<string | symbol, Array<Watcher>> = targetMap.get(target)\r\n  if (!mapping) targetMap.set(target, mapping = {})\r\n\r\n  let mappingProp: Array<Watcher> = mapping[prop]\r\n  if (!mappingProp) mappingProp = mapping[prop] = []\r\n\r\n  // 针对于对数组响应做特殊处理\r\n  if (isArray(target[prop])) {\r\n    if (activeWatcher.depArr) {\r\n      activeWatcher.depArr = false\r\n    } else {\r\n      if (activeWatcher.depArr === undefined) {\r\n        activeWatcher.depArr = target[prop].slice()\r\n      }\r\n    }\r\n  }\r\n\r\n  mappingProp.push(activeWatcher)\r\n}\r\n\r\n// 设置全局变量\r\nexport function setActiver(fn: Watcher | null) {\r\n  activeWatcher = fn\r\n}\r\n// 设置全局变量\r\nexport function getActiver(): Watcher | null {\r\n  return activeWatcher\r\n}\r\n\r\n","import { track, trigger } from './reactive'\r\n\r\nexport class RefImpl<T = any> {\r\n  private _value: T\r\n  private _target: Record<any, any>\r\n\r\n  constructor(value: T) {\r\n    this._value = value\r\n    this._target = { value: this._value }\r\n  }\r\n\r\n  get value() {\r\n    track(this._target, 'value')\r\n    return this._value\r\n  }\r\n\r\n  set value(value) {\r\n    this._value = value\r\n    this._target.value = this._value\r\n    trigger(this._target, 'value')\r\n  }\r\n}\r\n\r\n\r\nexport function ref<T extends any>(value: T): RefImpl<T> {\r\n  return new RefImpl(value)\r\n}","import { ref } from './ref'\r\nimport { reactive } from './reactive'\r\n\r\n\r\nexport function state<T extends any>(value: T) {\r\n  return ref(value)\r\n}\r\n\r\nexport function defineState<T extends Record<string | symbol, any>>(target: T): T {\r\n  return reactive(target)\r\n}\r\n\r\n\r\n\r\n\r\n\r\n","\r\n/**\r\n * 响应式对象\r\n*/\r\nexport class Activer<T = any> {\r\n  callback: () => T\r\n  flag: string = 'activer'\r\n\r\n  constructor(fn: () => T) {\r\n    this.callback = fn\r\n  }\r\n\r\n  get value(): T {\r\n    return this.callback()\r\n  }\r\n}\r\n\r\n/**\r\n * 外置函数\r\n*/\r\nexport function active<T extends any>(fn: () => T): Activer<T> {\r\n  return new Activer(fn)\r\n}\r\n\r\n","import { Activer } from \"../reactive\"\r\nimport { Child } from \"../render\"\r\nimport { VNode, VNODE_TYPE } from \"./vnode\"\r\n\r\nexport const AliveSymbol = Symbol('Alive')\r\nexport interface VAlive extends VNode {\r\n\r\n  // 虚拟节点类型\r\n  type: symbol,\r\n  // 虚拟节点表标识\r\n  flag: VNODE_TYPE.ELEMENT\r\n\r\n  activer: Activer<Child>\r\n  // 目前存在的节点\r\n  vnode: VNode\r\n}","import { active } from \"./reactive/active\";\r\nimport { Activer } from './reactive'\r\nimport { isString, isFragment, isText, isFunction, isArrayNode, isOnEvent, isVNode, isActiver, isArray } from \"./utils\";\r\nimport { ComponentConstructor, FunctionConstructor, ClassConstructor } from \"./vnode/component\";\r\nimport { VNode, VNODE_TYPE } from \"./vnode/vnode\";\r\nimport { ArraySymbol } from \"./vnode/array\";\r\nimport { AliveSymbol } from \"./vnode/alive\";\r\nimport { TextSymbol } from './vnode/text'\r\nimport { FragmentSymbol } from \"./vnode/fragment\";\r\n\r\n/**\r\n * 传说中的render函数\r\n*/\r\n\r\nexport type H = (type: string | symbol | ComponentConstructor, props?: Record<string, any> | null, mayChildren?: Child | Array<Child>) => VNode\r\n// 未经过标准化的children类型\r\nexport type Child = (() => Child) | string | VNode | Array<Child> | Activer | Exclude<(() => Child) | string | VNode | Array<Child> | Activer, any>\r\n\r\n/**\r\n * 函数转化为activer转化为VAlive\r\n * activer转化为VAlive\r\n * string转化为VText\r\n * 数组转化为VArray\r\n * 其他转化为VText\r\n*/\r\nexport function standarVNode(node: Child): VNode {\r\n  if (isVNode(node)) return node\r\n\r\n  if (isFunction(node)) return renderAlive(active(node))\r\n  else if (isActiver(node)) return renderAlive(node)\r\n  else if (isString(node)) return renderText(node)\r\n  else if (isArray(node)) return renderArrayNode(node.map(item => standarVNode(item)))\r\n  else {\r\n    let value = node\r\n    let retText: VNode\r\n    if (!value && typeof value !== 'number') retText = renderText('')\r\n    else retText = renderText(String(value))\r\n    return retText\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * text(不需要props)、fragment(不需要props)、element、component为显性创建\r\n * array(不需要props)、alive(不需要props)为隐形创建\r\n*/\r\nexport function render(type: string | symbol | ComponentConstructor, props?: Record<string, any> | null, mayChildren?: Child | Array<Child>): VNode {\r\n  // text的children比较特殊先处理\r\n  if (isText(type)) {\r\n    return renderText(String(mayChildren))\r\n  }\r\n\r\n  let children: Array<Child>\r\n  // 预处理 处理为单个的children\r\n  if (isArray(mayChildren)) children = mayChildren\r\n  else children = [mayChildren as Child]\r\n\r\n  let standardChildren: Array<VNode> = children.map(child => standarVNode(child))\r\n\r\n  // 属性预处理\r\n  if (props) {\r\n    for (const prop in props) {\r\n      // 以on开头的事件不需要处理\r\n      if (!isOnEvent(prop) && isFunction(props[prop])) {\r\n        props[prop] = active(props[prop])\r\n      }\r\n    }\r\n  }\r\n\r\n  if (isString(type)) return renderElement(type, props || {}, standardChildren)\r\n  if (isFragment(type)) return renderFragment(standardChildren)\r\n  if (isArrayNode(type)) return renderArrayNode(standardChildren)\r\n  if (isFunction(type)) return renderComponent(type, props || {}, standardChildren)\r\n  throw '传入参数不合法'\r\n}\r\n\r\nfunction renderText(text: string): VNode {\r\n  return {\r\n    type: TextSymbol,\r\n    flag: VNODE_TYPE.TEXT,\r\n    children: text\r\n  }\r\n}\r\n\r\nfunction renderElement(tag: string, props: Record<string, any>, children: Array<VNode>): VNode {\r\n  return {\r\n    type: tag,\r\n    flag: VNODE_TYPE.ELEMENT,\r\n    props,\r\n    children\r\n  }\r\n}\r\n\r\nfunction renderFragment(children: Array<VNode>): VNode {\r\n  return {\r\n    type: FragmentSymbol,\r\n    flag: VNODE_TYPE.FRAGMENT,\r\n    children\r\n  }\r\n}\r\n\r\nfunction renderArrayNode(children: Array<VNode>): VNode {\r\n  return {\r\n    type: ArraySymbol,\r\n    flag: VNODE_TYPE.ARRAYNODE,\r\n    children\r\n  }\r\n}\r\n\r\n\r\n// 判断是普通函数还是构造函数\r\nfunction renderComponent(component: ComponentConstructor, props: Record<string, any>, children: Array<VNode>): VNode {\r\n  let cprops: Record<string, any> = {}\r\n  for (let prop in props) {\r\n    let cur = props[prop]\r\n    if (isActiver(cur)) {\r\n      Object.defineProperty(cprops, prop, {\r\n        get() {\r\n          return (<Activer>cur).value\r\n        }\r\n      })\r\n    } else {\r\n      cprops[prop] = cur\r\n    }\r\n  }\r\n\r\n  if (component.prototype && component.prototype.render && isFunction(component.prototype.render)) {\r\n    let Constructor = component as ClassConstructor\r\n    let result = new Constructor(cprops, children)\r\n    result.props = cprops\r\n    result.children = children\r\n    return standarVNode(result.render(render))\r\n  } else {\r\n    let Fun = component as FunctionConstructor\r\n    return standarVNode(Fun(cprops, children))\r\n  }\r\n}\r\n\r\n\r\nfunction renderAlive(activer: Activer): VNode {\r\n  return {\r\n    type: AliveSymbol,\r\n    flag: VNODE_TYPE.ALIVE,\r\n    activer\r\n  }\r\n}\r\n","import { setActiver } from \"./reactive\"\r\nimport { active, Activer } from './active'\r\nimport { VNode, VNODE_TYPE } from \"../vnode/vnode\"\r\nimport { isActiver } from \"../utils\"\r\nimport { Child, standarVNode } from \"../render\"\r\nimport { VArrayNode } from \"../vnode/array\"\r\nimport { VAlive } from \"../vnode/alive\"\r\n\r\ntype Meta = {\r\n  targetPropOldValue: any,\r\n  targetPropnewValue: any\r\n}\r\n\r\n/**\r\n * 观察者\r\n * 观察数据的变化\r\n*/\r\nexport class Watcher<T = any> {\r\n  value: T\r\n  callback: (oldValue: T, newValue: T, meta?: Meta) => void\r\n  activeProps: Activer<T>\r\n  depArr?: Array<any> | false\r\n  nextDepArr?: Array<any>\r\n\r\n  constructor(activeProps: Activer<T>, callback: (oldValue: T, newValue: T, meta?: Meta) => void) {\r\n    setActiver(this)\r\n    this.value = activeProps.value\r\n    this.callback = callback\r\n    this.activeProps = activeProps\r\n    setActiver(null)\r\n  }\r\n\r\n  update() {\r\n    let newValue = this.activeProps.value\r\n    let oldValue = this.value\r\n    this.value = newValue\r\n    let meta = { targetPropOldValue: this.depArr, targetPropnewValue: this.nextDepArr }\r\n    this.callback(oldValue, newValue, meta)\r\n    this.depArr = this.nextDepArr?.slice()\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * 监控自定义响应式属性\r\n*/\r\nexport function watch<T = any>(activeProps: (() => T) | Activer<T>, callback: (oldValue: T, newValue: T) => void): Watcher<T> {\r\n  if (!isActiver(activeProps)) activeProps = active(activeProps)\r\n  return new Watcher<T>(activeProps, function (oldValue: T, newValue: T) {\r\n    callback(oldValue, newValue)\r\n  })\r\n}\r\n\r\n/**\r\n * 监控可变状态dom\r\n*/\r\nexport function watchVNode(activeVNode: VAlive, callback: (oldVNode: VNode, newVNode: VNode) => void): VNode {\r\n  let watcher = new Watcher<Child>(activeVNode.activer, function (oldValue: Child, newValue: Child, meta) {\r\n    const oldVNode = oldValue as VNode\r\n    const newVNode = standarVNode(newValue)\r\n\r\n    // 对于数组节点后期需要记录它的响应式数组用于节点更新\r\n    if (oldVNode.flag === VNODE_TYPE.ARRAYNODE) {\r\n      (<VArrayNode>oldVNode).depArray = meta?.targetPropOldValue\r\n    }\r\n    // 对于数组节点后期需要记录它的响应式数组用于节点更新\r\n    if (newVNode.flag === VNODE_TYPE.ARRAYNODE) {\r\n      (<VArrayNode>newVNode).depArray = meta?.targetPropnewValue\r\n    }\r\n\r\n    callback(oldVNode, newVNode)\r\n    watcher.value = newVNode\r\n    activeVNode.vnode = newVNode\r\n  })\r\n\r\n  return watcher.value = standarVNode(watcher.value)\r\n}\r\n\r\n\r\n/**\r\n * 监控可变dom的prop\r\n*/\r\nexport function watchProp(activeProp: Activer, callback: (oldVNode: VNode, newVNode: VNode) => void): any {\r\n  return new Watcher(activeProp, callback).value\r\n}","import { Vact } from \"../vact\"\r\nimport { watchProp } from \"../reactive\"\r\nimport { isActiver, isOnEvent, isFunction, isObject } from \"../utils\"\r\nimport { VElement } from \"../vnode/element\"\r\nimport { mountChildren } from \"./mount\"\r\nimport { patchElementProp } from \"./patch\"\r\n\r\n\r\n\r\nexport function mountElement(vnode: VElement, container: HTMLElement, anchor?: HTMLElement, app?: Vact) {\r\n  const el = document.createElement(vnode.type)\r\n  vnode.el = el\r\n  mountElementProps(vnode)\r\n  mountChildren(vnode.children, el, undefined, app)\r\n  container.insertBefore(el, anchor!)\r\n}\r\n\r\nexport function unmountElement(vnode: VElement, container: HTMLElement) {\r\n  vnode.el.remove()\r\n}\r\n\r\nexport function mountElementProps(vnode: VElement) {\r\n  let el = vnode.el\r\n  let props = vnode.props\r\n\r\n  // 处理标签属性\r\n  for (let prop in props) {\r\n    let value = props[prop]\r\n    if (isActiver(value)) {\r\n      let firstValue = watchProp(value, (oldValue, newValue) => patchElementProp(oldValue, newValue, el, prop))\r\n      setElementProp(el, prop, firstValue)\r\n    } else {\r\n      setElementProp(el, prop, value)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 处理单个dom属性\r\n*/\r\nexport function setElementProp(el: HTMLElement, prop: string, value: any) {\r\n  if (isOnEvent(prop) && isFunction(value)) {\r\n    let pattern = /^on(.+)$/\r\n    let result = prop.match(pattern)\r\n    result && el.addEventListener(result[1].toLocaleLowerCase(), value.bind(el))\r\n    return\r\n  }\r\n\r\n  switch (prop) {\r\n    case 'className':\r\n      el.className = String(value)\r\n      break\r\n    case 'style':\r\n      if (isObject(value)) {\r\n        value = mergeStyle(value)\r\n      }\r\n    default:\r\n      el.setAttribute(prop, value)\r\n  }\r\n}\r\n\r\n/**\r\n * 将对象形式的style转化为字符串\r\n*/\r\nexport function mergeStyle(style: Record<any, any>): string {\r\n  let styleStringList = []\r\n  for (let cssAttr in style) {\r\n    styleStringList.push(`${cssAttr}:${style[cssAttr]};`)\r\n  }\r\n  return styleStringList.join('')\r\n}","import { unmount, mount } from \"./mount\";\r\nimport { Vact } from \"../vact\";\r\nimport { VArrayNode } from \"../vnode/array\";\r\nimport { VText } from \"../vnode/text\";\r\nimport { VNode, VNODE_TYPE } from \"../vnode/vnode\";\r\nimport { setElementProp } from \"./element\";\r\n\r\nexport function isSameVNode(oldVNode: VNode, newVNode: VNode): boolean {\r\n  return oldVNode.flag === newVNode.flag\r\n}\r\n\r\nexport function getNextSibling(vnode: VNode): HTMLElement | Text | undefined {\r\n  switch (vnode.flag) {\r\n    case VNODE_TYPE.TEXT:\r\n    case VNODE_TYPE.ELEMENT:\r\n    case VNODE_TYPE.ARRAYNODE:\r\n    case VNODE_TYPE.FRAGMENT:\r\n      return vnode.el!\r\n    case VNODE_TYPE.ALIVE:\r\n      return getNextSibling(vnode.vnode!)\r\n  }\r\n}\r\n\r\nexport function patch(oldVNode: VNode, newVNode: VNode, container: HTMLElement, app?: Vact): void {\r\n\r\n  // 如果两个节点引用一样不需要判断\r\n  if (oldVNode === newVNode) return\r\n\r\n  // 这里在判断相同类型的节点后可以做进一步优化\r\n  if (isSameVNode(oldVNode, newVNode)) {\r\n    let flag = oldVNode.flag = newVNode.flag\r\n\r\n    if (flag === VNODE_TYPE.TEXT) {\r\n      patchText(<VText>oldVNode, <VText>newVNode, container)\r\n    } else if (flag === VNODE_TYPE.ARRAYNODE) {\r\n      if (app?.options.arrayDiff) {\r\n        patchArrayNodeT(<VArrayNode>oldVNode, <VArrayNode>newVNode, container)\r\n      } else {\r\n        patchArrayNode(<VArrayNode>oldVNode, <VArrayNode>newVNode, container)\r\n      }\r\n    } else {\r\n      const nextSibling = oldVNode?.el?.nextSibling\r\n      // const nextSibling = getNextSibling(oldVNode)\r\n      unmount(oldVNode, container)\r\n      mount(newVNode, container, nextSibling as HTMLElement | undefined)\r\n    }\r\n\r\n  } else {\r\n    const nextSibling = oldVNode?.el?.nextSibling\r\n    // const nextSibling = getNextSibling(oldVNode)\r\n    unmount(oldVNode, container)\r\n    mount(newVNode, container, nextSibling as HTMLElement | undefined)\r\n  }\r\n\r\n}\r\n\r\nexport function patchText(oldVNode: VText, newVNode: VText, container: HTMLElement) {\r\n  oldVNode.el!.nodeValue = newVNode.children\r\n  newVNode.el = oldVNode.el\r\n}\r\n\r\nexport function patchElementProp(oldValue: any, newValue: any, el: HTMLElement, prop: string) {\r\n  setElementProp(el, prop, newValue)\r\n}\r\n\r\nexport function patchArrayNodeT(oldVNode: VArrayNode, newVNode: VArrayNode, container: HTMLElement) {\r\n  if (!oldVNode.depArray) {\r\n    patchArrayNode(oldVNode, newVNode, container)\r\n    return\r\n  }\r\n\r\n  const oldDepArray = oldVNode.depArray\r\n  const newDepArray = newVNode.depArray\r\n  const oldChildren = oldVNode.children\r\n  const newChildren = newVNode.children\r\n\r\n  type NodeInfo = { node: VNode, index: number, used: boolean }\r\n  // 为映射做初始化\r\n  let map = new Map<any, Array<NodeInfo>>()\r\n  oldDepArray.forEach((item, index) => {\r\n    let arr = map.get(item)\r\n    if (!arr) map.set(item, arr = [])\r\n    arr.push({ node: oldChildren[index], index, used: false })\r\n  })\r\n\r\n  let getOld = (item: any) => {\r\n    let arr = map.get(item)\r\n    if (!arr) return false\r\n\r\n    let index = arr.findIndex(alone => !alone.used)\r\n\r\n    if (index > -1) return arr[index]\r\n    else return false\r\n  }\r\n\r\n  let moveOld = (item: any, node: NodeInfo) => {\r\n    let arr = map.get(item)\r\n    if (!arr) return\r\n\r\n    let index = arr.findIndex(alone => alone === node)\r\n    arr.splice(index, 1)\r\n  }\r\n\r\n  let maxIndexSoFar = { node: oldChildren[0], index: 0 }\r\n\r\n  newDepArray.forEach((item, newIndex) => {\r\n    let old = getOld(item)\r\n    if (old) {\r\n      if (old.index < maxIndexSoFar.index) {\r\n        let next = maxIndexSoFar.node.el!.nextSibling\r\n        VNodeInsertBefore(container, old.node, next)\r\n        // container.insertBefore(old.node.el!, next)\r\n      }\r\n      maxIndexSoFar = old\r\n      newChildren[newIndex] = old.node\r\n      moveOld(item, old)\r\n    } else {\r\n      let next = maxIndexSoFar.node.el!.nextSibling\r\n      let newNode = newChildren[newIndex]\r\n      mount(newNode, container, next as HTMLElement | undefined)\r\n      maxIndexSoFar = { node: newNode, index: maxIndexSoFar.index + 1 }\r\n    }\r\n  })\r\n\r\n\r\n  map.forEach(value => {\r\n    value.forEach(item => {\r\n      if (!item.used) {\r\n        unmount(item.node, container)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nfunction patchArrayNode(oldVNode: VArrayNode, newVNode: VArrayNode, container: HTMLElement) {\r\n  const nextSibling = oldVNode.el.nextSibling\r\n  unmount(oldVNode, container)\r\n  mount(newVNode, container, nextSibling as HTMLElement | undefined)\r\n}\r\n\r\nfunction VNodeInsertBefore(container: HTMLElement, node: VNode, next: HTMLElement | undefined | Text | ChildNode | null) {\r\n  if (node.flag === VNODE_TYPE.ELEMENT || node.flag === VNODE_TYPE.TEXT) {\r\n    container.insertBefore(node.el!, next!)\r\n  } else if (node.flag === VNODE_TYPE.ARRAYNODE || node.flag === VNODE_TYPE.FRAGMENT) {\r\n    let start: ChildNode | null | undefined = node.anchor\r\n    let nextToMove = start?.nextSibling\r\n    let end: ChildNode | null | undefined = node.el\r\n    while (start !== end) {\r\n      container.insertBefore(start!, next!)\r\n      start = nextToMove\r\n      nextToMove = start?.nextSibling\r\n    }\r\n    container.insertBefore(end!, next!)\r\n  }\r\n}","import { patch } from \"./patch\";\r\nimport { watchVNode } from \"../reactive/watch\";\r\nimport { Vact } from \"../vact\";\r\nimport { VAlive } from \"../vnode/alive\";\r\nimport { VArrayNode } from \"../vnode/array\";\r\nimport { VComponent } from \"../vnode/component\";\r\nimport { VElement } from \"../vnode/element\";\r\nimport { VFragment } from \"../vnode/fragment\";\r\nimport { VText } from '../vnode/text'\r\nimport { VNode, VNODE_TYPE } from \"../vnode/vnode\";\r\nimport { mountElement, unmountElement } from \"./element\";\r\n\r\nexport function mount(vnode: VNode, container: HTMLElement, anchor?: HTMLElement, app?: Vact) {\r\n  switch (vnode.flag) {\r\n    case VNODE_TYPE.ELEMENT:\r\n      mountElement(vnode as VElement, container, anchor, app)\r\n      break\r\n    case VNODE_TYPE.TEXT:\r\n      mountText(vnode as VText, container, anchor)\r\n      break\r\n    case VNODE_TYPE.FRAGMENT:\r\n      mountFragment(vnode as VFragment, container, anchor, app)\r\n      break\r\n    case VNODE_TYPE.ARRAYNODE:\r\n      mountArrayNode(vnode as VArrayNode, container, anchor, app)\r\n      break\r\n    // case VNODE_TYPE.COMPONENT:\r\n    //   mountComponent(vnode as VComponent, container, anchor, app)\r\n    //   break\r\n    case VNODE_TYPE.ALIVE:\r\n      mountAlive(vnode as VAlive, container, anchor, app)\r\n      break\r\n  }\r\n}\r\n\r\nexport function unmount(vnode: VNode, container: HTMLElement) {\r\n  switch (vnode.flag) {\r\n    case VNODE_TYPE.ELEMENT:\r\n      unmountElement(vnode as VElement, container)\r\n      break\r\n    case VNODE_TYPE.TEXT:\r\n      unmountText(vnode as VText, container)\r\n      break\r\n    case VNODE_TYPE.FRAGMENT:\r\n      unmountFragment(vnode as VFragment, container)\r\n      break\r\n    case VNODE_TYPE.ARRAYNODE:\r\n      unmountArrayNode(vnode as VArrayNode, container)\r\n      break\r\n    // case VNODE_TYPE.COMPONENT:\r\n    //   unmountComponent(vnode as VComponent, container)\r\n    //   break\r\n  }\r\n}\r\n\r\nexport function mountChildren(children: Array<VNode>, container: HTMLElement, anchor?: HTMLElement, app?: Vact) {\r\n  children.forEach(child => mount(child, container, anchor, app))\r\n}\r\n\r\nexport function mountText(vnode: VText, container: HTMLElement, anchor?: HTMLElement) {\r\n  const el = document.createTextNode(vnode.children)\r\n  vnode.el = el\r\n  container.insertBefore(el, anchor!)\r\n}\r\n\r\nexport function unmountText(vnode: VText, container: HTMLElement) {\r\n  vnode.el.remove()\r\n}\r\n\r\nexport function mountFragment(vnode: VFragment, container: HTMLElement, anchor?: HTMLElement, app?: Vact) {\r\n  const start = document.createTextNode('')\r\n  const end = document.createTextNode('')\r\n  vnode.anchor = start\r\n  vnode.el = end\r\n  container.insertBefore(start, anchor!)\r\n  mountChildren(vnode.children, container, anchor, app)\r\n  container.insertBefore(end, anchor!)\r\n}\r\n\r\nexport function unmountFragment(vnode: VFragment, container: HTMLElement) {\r\n  const start = vnode.anchor\r\n  const end = vnode.el\r\n  let cur: ChildNode | null = start\r\n  while (cur && cur !== end) {\r\n    let next: ChildNode | null = cur.nextSibling\r\n    cur.remove()\r\n    cur = next\r\n  }\r\n  end.remove()\r\n}\r\n\r\nexport function mountArrayNode(vnode: VArrayNode, container: HTMLElement, anchor?: HTMLElement, app?: Vact) {\r\n  const start = document.createTextNode('')\r\n  const end = document.createTextNode('')\r\n  vnode.anchor = start\r\n  vnode.el = end\r\n  container.insertBefore(start, anchor!)\r\n  mountChildren(vnode.children, container, anchor, app)\r\n  container.insertBefore(end, anchor!)\r\n}\r\n\r\nexport function unmountArrayNode(vnode: VArrayNode, container: HTMLElement, anchor?: HTMLElement) {\r\n  const start = vnode.anchor\r\n  const end = vnode.el\r\n  let cur: ChildNode | null = start\r\n  while (cur && cur !== end) {\r\n    let next: ChildNode | null = cur.nextSibling\r\n    cur.remove()\r\n    cur = next\r\n  }\r\n  end.remove()\r\n}\r\n\r\n// export function mountComponent(vnode: VComponent, container: HTMLElement, anchor?: HTMLElement, app?: Vact) {\r\n//   console.log(1111);\r\n\r\n//   const root = vnode.type.render(render)\r\n//   vnode.root = root\r\n//   mount(root, container, anchor, app)\r\n//   vnode.el = root.el!\r\n// }\r\n\r\n// export function unmountComponent(vnode: VComponent, container: HTMLElement) {\r\n//   unmount(vnode.root, container)\r\n// }\r\n\r\nexport function mountAlive(vnode: VAlive, container: HTMLElement, anchor?: HTMLElement, app?: Vact) {\r\n  let firstVNode = watchVNode(vnode, (oldVNode, newVNode) => patch(oldVNode, newVNode, container, app))\r\n  vnode.vnode = firstVNode\r\n  mount(firstVNode, container, anchor, app)\r\n}","import { defineState } from \"./reactive\"\r\nimport { H } from './render'\r\nimport { VNode } from \"./vnode/vnode\"\r\n\r\n/**\r\n * 根类组件(向下兼容)\r\n * 已废弃\r\n*/\r\n\r\ninterface Config {\r\n  data?: Record<string | symbol, any>\r\n}\r\n\r\nexport abstract class Component {\r\n  // 组件配置\r\n  private config: Config\r\n  // 组件响应式数据\r\n  public data: Record<any, any>\r\n  // 组件属性\r\n  props?: Record<any, any>\r\n  // 组件子元素\r\n  children?: Record<string, any>\r\n\r\n  constructor(config: Config = {}) {\r\n    this.config = config\r\n    this.data = defineState(config.data || {})\r\n  }\r\n\r\n  abstract render(h: H): VNode\r\n}","import { mount } from \"./mount/mount\";\r\nimport { defineState, state } from \"./reactive\";\r\nimport { RefImpl } from \"./reactive/ref\";\r\nimport { render } from \"./render\";\r\nimport { VNode } from \"./vnode/vnode\";\r\nimport { H } from './render'\r\n\r\nexport interface Options {\r\n  arrayDiff?: boolean\r\n}\r\n\r\nexport interface VactUtils {\r\n  state<T extends unknown>(value: T): RefImpl<T>\r\n  defineState<T extends Record<string | symbol, any>>(target: T): T\r\n  h: H\r\n}\r\n\r\nexport interface VactPlugin {\r\n  install(utils: VactUtils): void\r\n}\r\n\r\nexport class Vact {\r\n  rootVNode: VNode\r\n  options: Options\r\n\r\n  constructor(vnode: VNode, options?: Options) {\r\n    this.rootVNode = vnode\r\n    this.options = options || {}\r\n  }\r\n\r\n  mount(selector: string): void {\r\n    const el = document.querySelector(selector)\r\n    let container = document.createElement('div')\r\n    mount(this.rootVNode, container, undefined, this)\r\n    el?.replaceWith(...container.childNodes)\r\n  }\r\n\r\n  use(plugin: VactPlugin) {\r\n    const utils: VactUtils = { state, defineState, h: render }\r\n    plugin.install(utils)\r\n  }\r\n}\r\n\r\nexport function createApp(vnode: VNode, options?: Options): Vact {\r\n  return new Vact(vnode, options)\r\n}\r\n\r\n"],"names":[],"mappings":"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"}