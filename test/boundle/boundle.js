!function(e,t){e&&!e.getElementById("livereloadscript")&&((t=e.createElement("script")).async=1,t.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",t.id="livereloadscript",e.getElementsByTagName("head")[0].appendChild(t))}(self.document),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Vact={})}(this,(function(e){"use strict";function t(){}function n(){n.init.call(this)}function r(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function i(e,t,n){if(t)e.call(n);else for(var r=e.length,i=u(e,r),s=0;s<r;++s)i[s].call(n)}function s(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=u(e,i),o=0;o<i;++o)s[o].call(n,r)}function o(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,o=u(e,s),a=0;a<s;++a)o[a].call(n,r,i)}function a(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var o=e.length,a=u(e,o),h=0;h<o;++h)a[h].call(n,r,i,s)}function h(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=u(e,i),o=0;o<i;++o)s[o].apply(n,r)}function l(e,n,i,s){var o,a,h,l;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",n,i.listener?i.listener:i),a=e._events),h=a[n]):(a=e._events=new t,e._eventsCount=0),h){if("function"==typeof h?h=a[n]=s?[i,h]:[h,i]:s?h.unshift(i):h.push(i),!h.warned&&(o=r(e))&&o>0&&h.length>o){h.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=n,c.count=h.length,l=c,"function"==typeof console.warn?console.warn(l):console.log(l)}}else h=a[n]=i,++e._eventsCount;return e}function c(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function f(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function u(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}t.prototype=Object.create(null),n.EventEmitter=n,n.usingDomains=!1,n.prototype.domain=void 0,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.init=function(){this.domain=null,n.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new t,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return r(this)},n.prototype.emit=function(e){var t,n,r,l,c,f,u,d="error"===e;if(f=this._events)d=d&&null==f.error;else if(!d)return!1;if(u=this.domain,d){if(t=arguments[1],!u){if(t instanceof Error)throw t;var p=new Error('Uncaught, unspecified "error" event. ('+t+")");throw p.context=t,p}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t),!1}if(!(n=f[e]))return!1;var g="function"==typeof n;switch(r=arguments.length){case 1:i(n,g,this);break;case 2:s(n,g,this,arguments[1]);break;case 3:o(n,g,this,arguments[1],arguments[2]);break;case 4:a(n,g,this,arguments[1],arguments[2],arguments[3]);break;default:for(l=new Array(r-1),c=1;c<r;c++)l[c-1]=arguments[c];h(n,g,this,l)}return!0},n.prototype.addListener=function(e,t){return l(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return l(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,c(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,c(this,e,t)),this},n.prototype.removeListener=function(e,n){var r,i,s,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===n||r.listener&&r.listener===n)0==--this._eventsCount?this._events=new t:(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if("function"!=typeof r){for(s=-1,o=r.length;o-- >0;)if(r[o]===n||r[o].listener&&r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new t,this;delete i[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(r,s);i.removeListener&&this.emit("removeListener",e,a||n)}return this},n.prototype.removeAllListeners=function(e){var n,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new t,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new t:delete r[e]),this;if(0===arguments.length){for(var i,s=Object.keys(r),o=0;o<s.length;++o)"removeListener"!==(i=s[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new t,this._eventsCount=0,this}if("function"==typeof(n=r[e]))this.removeListener(e,n);else if(n)do{this.removeListener(e,n[n.length-1])}while(n[0]);return this},n.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},n.prototype.listenerCount=f,n.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class d extends n{constructor(e,t){super(),this.value=e,this.dep=[],this.dataProxy=t}setDep(e){this.dep.push(e)}valueOf(){return this.value}toString(){return this.value}set(e){this.value=e}get(){return this.value}notify(){this.dep.forEach((e=>{e.update()})),this.emit("change",this.value)}}class p{constructor(e){this.running=!1,this.fn=e}update(){if(this.running)return;this.running=!0;!function(e){C.runTask(e)}((()=>{this.fn(),this.running=!1}))}}class g{constructor(){this.valueMap=new WeakMap}getProp(e,t){this.valueMap.get(e)||this.valueMap.set(e,{});let n=this.valueMap.get(e);if(!n[t]){let r=new d(Array.isArray(e[t])?new Proxy(e[t],{set(e,t,n,i){let s=Reflect.set(e,t,n,i);return r.notify(),s}}):e[t]);n[t]=r}return n[t]}getEventProxy(e){return this.valueMap.get(e)}setEventProxy(e,t){this.valueMap.set(e,t)}}class y{constructor(e){this.target=e,this.dataProxyValue=new g;const t={get:(e,n,r)=>{if("object"!=typeof e[n]||null===e[n]||Array.isArray(e[n])||e[n].constructor!==Object){if("function"==typeof e[n])return Reflect.get(e,n,r);{let t=this.dataProxyValue.getProp(e,n);for(let e of C.getDepPool())e.includes(t)||e.push(t);return t.value}}return new Proxy(e[n],t)},set:(e,t,n,r)=>{if("object"!=typeof n||null===n||Array.isArray(n)||n.constructor!==Object){let i=this.dataProxyValue.getProp(e,t);i.value=Array.isArray(n)?new Proxy(n,{set(e,t,n,r){let s=Reflect.set(e,t,n,r);return i.notify(),s}}):n;let s=Reflect.set(e,t,n,r);return i.notify(),s}{let i=this.dataProxyValue.getEventProxy(e[t]),s=Reflect.set(e,t,n,r);return this.replaceProps(n,i),s}}};this.data=new Proxy(e,t)}getData(){return this.data}getTarget(){return this.target}getEventProxy(){return this.dataProxyValue}replaceProps(e,t){for(let n in t){let r=t[n];r.value=e[n],r.notify()}this.dataProxyValue.setEventProxy(e,t)}}class m{constructor(e,t){this.dataProxy=new y(e),this.config=t}get data(){return this.dataProxy.getData()}watch(e,t){let n=e.split(".");if(!n.length)return;let r=this.dataProxy.getTarget(),i=n.shift()||"";for(;n.length;){let e=n.shift();e&&(r=r[i],i=e)}this.dataProxy.getEventProxy().getProp(r,i).on("change",t)}}class v{setParentVNode(e){this.parentVNode=e}}v.ELEMENT=0,v.TEXT=1,v.COMPONENT=2,v.FRAGMENT=3;class N extends v{constructor(e){super(),this.type=v.TEXT,this.text=e}createTextNode(){return this.textNode=document.createTextNode(this.text),this.textNode}getRNode(){return this.textNode}}class w extends v{constructor(e,t){super(),this.type=v.FRAGMENT,this.props=e,this.children=t,this.VNodeChildren=[],this.pivot=new N(""),this.pivot.createTextNode()}getPivot(){return this.pivot}setPivot(e){this.pivot=e}getRNode(){return this.fragment}getParentMountedEle(){return this.parentVNode instanceof w?this.parentVNode.getParentMountedEle():this.parentVNode.getRNode()}createFragment(){return this.fragment||(this.fragment=document.createDocumentFragment(),this.setChildren()),this.fragment}setChildren(){if(this.fragment&&void 0!==this.children&&null!==this.children){Array.isArray(this.children)||(this.children=[this.children]);for(let e=0;e<this.children.length;e++){let t=this.children[e];if("function"!=typeof t){L(this.fragment,this.VNodeChildren[e]=b(t,this));continue}let[n,r]=x(t);if(Array.isArray(r)){let i=_("");L(this.fragment,i),this.VNodeChildren[e]=b(r,this),M(this.fragment,this.VNodeChildren[e],i);let s=()=>{D(this.VNodeChildren[e]);let n=t();Array.isArray(n)&&(this.VNodeChildren[e]=b(n,this),M(this.getParentMountedEle(),this.VNodeChildren[e],i))};n.forEach((e=>e.setDep(new p(s))))}else{this.VNodeChildren[e]=_(r,this),L(this.fragment,this.VNodeChildren[e]);let i=()=>{let n=t();this.VNodeChildren[e]=T(this.getParentMountedEle(),_(n,this),this.VNodeChildren[e])};n.forEach((e=>e.setDep(new p(i))))}}}}}function E(e,t){let n,r=document.querySelector(e);if(t instanceof O){let e=t.createEFVNode();if(!(e instanceof R))throw new Error("用于挂载渲染的根组件必须使用原始标签");n=e.createEle()}else if(t instanceof V){let e=t.createComponent().createEFVNode();if(!(e instanceof R))throw new Error("用于挂载渲染的根组件必须使用原始标签");n=e.createEle()}r&&n&&r.parentNode&&r.parentNode.replaceChild(n,r)}function P(e,t,n){if("string"==typeof e)return new R(e,t,n);if("function"==typeof e)return new V(e,t,n);if("symbol"==typeof e&&e===C.Fragment)return new w(t,n);throw new Error("只能传入字符串或者构造函数")}class C{static getDepPool(){return this.depPool}static runTask(e){this.watcherTask.push(e),this.updating||(this.updating=!0,Promise.resolve().then((()=>{let e;for(;e=this.watcherTask.shift();)e()})).then((()=>this.updating=!1)))}}function x(e){let t=[],n=C.getDepPool();n.push(t);let r=e();return n.splice(n.indexOf(t),1),[t,r]}C.Fragment=Symbol("fragment标识"),C.depPool=[],C.updating=!1,C.watcherTask=[],C.mount=E,C.createNode=P;class V extends v{constructor(e,t,n){super(),this.type=v.COMPONENT,this.Constructor=e,this.props=t||{},Array.isArray(n)?this.children=n:this.children=null!=n?[n]:[]}createComponent(){if(this.component)return this.component;let e=new y({}).getData();for(let t in this.props){if("function"!=typeof this.props[t]){e[t]=this.props[t];continue}let[n,r]=x(this.props[t]);if("function"==typeof r)e[t]=r;else{e[t]=r;let i=()=>e[t]=this.props[t]();n.forEach((e=>{e.setDep(new p(i))}))}}let t=new y([]).getData();if(this.children)for(let e=0;e<this.children.length;e++){if("function"!=typeof this.children[e]){t[e]=this.children[e];continue}let[n,r]=x(this.children[e]);if("function"==typeof r)t[e]=r;else{t[e]=r;let i=()=>t[e]=this.children[e]();n.forEach((e=>{e.setDep(new p(i))}))}}let n=this.Constructor;if(n.prototype&&n.prototype.classComponent)this.component=new n;else{let e=new k;e.setRenderFun(n),this.component=e}return this.component.setProps(e),this.component.setChildren(t),this.component}getComponent(){return this.component}getRNode(){if(this.component instanceof O)return this.component.getEFVNode().getRNode();if(this.component instanceof R)return this.component.getRNode();throw new Error("组件初始化")}}class R extends v{constructor(e,t,n){super(),this.type=v.ELEMENT,this.tag=e,this.props=t,this.children=n}getRNode(){return this.ele}createEle(){if(!this.ele)return this.ele=document.createElement(this.tag),this.setProps(),this.setChildren(),this.ele}setProps(){if(this.props&&this.ele)for(let e in this.props){if("function"!=typeof this.props[e]){A(this.ele,e,this.props[e]);continue}let[t,n]=x(this.props[e]);if(A(this.ele,e,n),"function"==typeof n)continue;let r=()=>A(this.ele,e,this.props[e]());t.forEach((e=>e.setDep(new p(r))))}}setChildren(){if(this.ele&&void 0!==this.children&&null!==this.children){Array.isArray(this.children)||(this.children=[this.children]);for(let e of this.children){if("function"!=typeof e){L(this.ele,b(e,this));continue}let[t,n]=x(e);if(Array.isArray(n)){let r=_("");L(this.ele,r);let i=b(n,this);M(this.ele,i,r);let s=()=>{D(i);let t=e();Array.isArray(t)&&(i=b(t,this),M(this.ele,i,r))};t.forEach((e=>e.setDep(new p(s))))}else{let r=_(n,this);L(this.ele,r);let i=()=>{let t=e();r=T(this.ele,_(t,this),r)};t.forEach((e=>e.setDep(new p(i))))}}}}}function A(e,t,n){if("string"==typeof n)"className"===t?e.className=n:e.setAttribute(t,n);else if("style"===t&&"object"==typeof n&&null!==n){let r=[];for(let e in n)r.push(`${e}:${n[e]};`);e.setAttribute(t,r.join(""))}else if("function"==typeof n){let r=/^on([a-zA-Z]+)/;if(r.test(t)){let i=t.match(r);i&&e.addEventListener(i[1].toLocaleLowerCase(),n.bind(e))}else e.addEventListener(t,n.bind(e))}}function L(e,t){if(Array.isArray(t))t.forEach((n=>{if(e.appendChild(n.getRNode()),n instanceof w&&e.appendChild(n.getPivot().getRNode()),t instanceof V){let n=t.getComponent().getEFVNode();n instanceof w&&e.appendChild(n.getPivot().getRNode())}}));else if(e.appendChild(t.getRNode()),t instanceof w&&e.appendChild(t.getPivot().getRNode()),t instanceof V){let n=t.getComponent().getEFVNode();n instanceof w&&e.appendChild(n.getPivot().getRNode())}}function _(e,t){if("string"==typeof e){let n=new N(e);return n.setParentVNode(t),n.createTextNode(),n}if(e instanceof V){let n=e.createComponent().createEFVNode();return n instanceof R?n.createEle():n.createFragment(),n.setParentVNode(t),e.setParentVNode(t),e}if(e instanceof R)return e.createEle(),e.setParentVNode(t),e;if(e instanceof w)return e.createFragment(),e.setParentVNode(t),e;{null===e&&(e="");let n=new N(String(e));return n.setParentVNode(t),n.createTextNode(),n}}function b(e,t){return Array.isArray(e)?e.map((e=>_(e,t))):_(e,t)}function T(e,t,n){if(t instanceof N&&n instanceof N)return n.getRNode().nodeValue=t.getRNode().nodeValue,n;let r,i;return r=t instanceof V?t.getComponent().getEFVNode():t,i=n instanceof V?n.getComponent().getEFVNode():n,i instanceof w?function(e,t,n){let r=n.getPivot();F(n),e.insertBefore(t.getRNode(),r.getRNode()),t instanceof w?r.getRNode().replaceWith(t.getPivot().getRNode()):r.getRNode().remove();return t}(e,r,i):r instanceof w?function(e,t,n){let r=t.getPivot();return n.getRNode().replaceWith(r.getRNode()),e.insertBefore(t.getRNode(),r.getRNode()),t}(e,r,i):(e.replaceChild(t.getRNode(),n.getRNode()),t)}function F(e){e.VNodeChildren.forEach((e=>{e instanceof w?F(e):Array.isArray(e)?D(e):e.getRNode().remove()}))}function M(e,t,n){let r=document.createDocumentFragment();t.forEach((e=>r.appendChild(e.getRNode()))),n?e.insertBefore(r,n.getRNode()):e.appendChild(r)}function D(e){e.forEach((e=>e.getRNode().remove()))}class O{constructor(e={}){this.config=e,this.data=new y(this.config.data||{}).getData()}setProps(e){this.props=e}setChildren(e){this.children=e}createEFVNode(){if(this.efVNode)return this.efVNode;let e=this.render(P);return e instanceof V&&(e=e.createComponent().createEFVNode()),this.efVNode=e}getEFVNode(){return this.efVNode}}O.prototype.classComponent=!0;class k extends O{constructor(){super()}setRenderFun(e){this.renderFun=e}render(){return this.renderFun.call(this,this.props,this.children)}}C.Component=O;const j=P,B=C.Fragment;e.Component=O,e.Fragment=B,e.createNode=P,e.default=C,e.defineState=function(e,t){return new m(e,t)},e.h=j,e.mount=E,Object.defineProperty(e,"__esModule",{value:!0})}));
